var Blindspot=(()=>{var U=Object.defineProperty;var Pt=Object.getOwnPropertyDescriptor;var Xt=Object.getOwnPropertyNames;var Yt=Object.prototype.hasOwnProperty;var Ut=(t,e)=>{for(var n in e)U(t,n,{get:e[n],enumerable:!0})},_t=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Xt(e))!Yt.call(t,i)&&i!==n&&U(t,i,{get:()=>e[i],enumerable:!(o=Pt(e,i))||o.enumerable});return t};var Vt=t=>_t(U({},"__esModule",{value:!0}),t);var Be={};Ut(Be,{init:()=>Se});var Jt=`
.blindspot-trigger {
  position: fixed;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  z-index: 2147483647;
  background: #FE795D;
  color: white;
  border: none;
  padding: 16px 10px 12px 10px;
  border-radius: 8px 0 0 8px;
  cursor: pointer;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: 13px;
  font-weight: 500;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  box-shadow: -2px 2px 8px rgba(0,0,0,0.15);
  transition: background 0.2s ease;
}

.blindspot-trigger:hover {
  background: #e5684d;
}

.blindspot-trigger svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.blindspot-trigger-text {
  writing-mode: vertical-rl;
  text-orientation: mixed;
  letter-spacing: 0.5px;
}

.blindspot-trigger-dots {
  display: flex;
  flex-direction: column;
  gap: 3px;
  opacity: 0.7;
}

.blindspot-trigger-dots span {
  width: 4px;
  height: 4px;
  background: white;
  border-radius: 50%;
}

/* Overlay */
.blindspot-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: 2147483647;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.blindspot-overlay-backdrop {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #201E1D;
}

.blindspot-overlay-content {
  position: relative;
  display: flex;
  flex-direction: column;
  height: 100%;
  z-index: 1;
  background: transparent;
}

/* Toolbar */
.blindspot-toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: #201E1D;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.blindspot-toolbar-tools {
  display: flex;
  align-items: center;
  gap: 8px;
}

.blindspot-close-btn {
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}

.blindspot-close-btn:hover {
  background: rgba(255,255,255,0.1);
}

/* Tool buttons */
.blindspot-tool-group {
  display: flex;
  align-items: center;
  gap: 4px;
}

.blindspot-tool-divider {
  width: 1px;
  height: 24px;
  background: rgba(255,255,255,0.2);
  margin: 0 8px;
}

.blindspot-tool-btn {
  background: transparent;
  border: none;
  color: rgba(255,255,255,0.7);
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s, color 0.2s;
}

.blindspot-tool-btn:hover {
  background: rgba(255,255,255,0.1);
  color: white;
}

.blindspot-tool-btn.active {
  background: #9B78F4;
  color: white;
}

/* Main content area */
.blindspot-main {
  display: flex;
  flex: 1;
  overflow: hidden;
  background: transparent;
}

.blindspot-canvas-area {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  overflow: auto;
  background: #201E1D;
  min-height: 0;
}

.blindspot-canvas-wrapper {
  position: relative;
  max-width: 100%;
  max-height: 100%;
  border-radius: 8px;
  box-shadow: 0 4px 24px rgba(0,0,0,0.3);
  overflow: hidden;
}

.blindspot-screenshot {
  display: block;
  max-width: 100%;
  max-height: calc(100vh - 120px);
}

.blindspot-drawing-canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  cursor: crosshair;
}

.blindspot-selected-highlights {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 5;
}

/* Sidebar */
.blindspot-sidebar {
  width: 320px;
  background: white;
  border-left: 1px solid rgba(0,0,0,0.1);
  overflow-y: auto;
  flex-shrink: 0;
}

.blindspot-sidebar-content {
  padding: 20px;
}

.blindspot-sidebar-header {
  margin-bottom: 20px;
}

.blindspot-sidebar-title {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #201E1D;
}

/* Form */
.blindspot-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.blindspot-form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.blindspot-label {
  font-size: 13px;
  font-weight: 500;
  color: #201E1D;
}

.blindspot-input,
.blindspot-textarea {
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
  font-family: inherit;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.blindspot-input:focus,
.blindspot-textarea:focus {
  outline: none;
  border-color: #FE795D;
  box-shadow: 0 0 0 3px rgba(254, 121, 93, 0.15);
}

.blindspot-textarea {
  resize: vertical;
  min-height: 80px;
}

/* Metadata display */
.blindspot-metadata {
  background: #f5f5f5;
  border-radius: 6px;
  padding: 10px 12px;
  font-size: 12px;
}

.blindspot-metadata-item {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
}

.blindspot-metadata-item:not(:last-child) {
  border-bottom: 1px solid #e5e5e5;
}

.blindspot-metadata-label {
  color: #666;
  font-weight: 500;
}

.blindspot-metadata-value {
  color: #201E1D;
  text-align: right;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  max-width: 160px;
}

/* Submit button */
.blindspot-submit-btn {
  background: #FE795D;
  color: white;
  border: none;
  padding: 12px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s;
  margin-top: 8px;
}

.blindspot-submit-btn:hover {
  background: #e5684d;
}

.blindspot-submit-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* Success message */
.blindspot-success {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 40px 20px;
}

.blindspot-success-icon {
  margin-bottom: 16px;
}

.blindspot-success-title {
  margin: 0 0 8px 0;
  font-size: 20px;
  font-weight: 600;
  color: #201E1D;
}

.blindspot-success-text {
  margin: 0 0 20px 0;
  color: #666;
  font-size: 14px;
}

.blindspot-success-link {
  display: inline-block;
  background: #FE795D;
  color: white;
  text-decoration: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 12px;
  transition: background 0.2s;
}

.blindspot-success-link:hover {
  background: #e5684d;
}

.blindspot-close-overlay-btn {
  background: transparent;
  border: 1px solid #ddd;
  color: #666;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: background 0.2s;
}

.blindspot-close-overlay-btn:hover {
  background: #f5f5f5;
}

/* Selected elements */
.blindspot-elements-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.blindspot-element-chip {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #f5f5f5;
  border: 1px solid #e5e5e5;
  border-radius: 6px;
  padding: 8px 10px;
  font-size: 12px;
}

.blindspot-element-tag {
  background: #9B78F4;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-weight: 600;
  font-size: 11px;
  text-transform: uppercase;
}

.blindspot-element-detail {
  flex: 1;
  color: #201E1D;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-family: monospace;
}

.blindspot-element-remove {
  background: transparent;
  border: none;
  color: #999;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s, color 0.2s;
}

.blindspot-element-remove:hover {
  background: rgba(0,0,0,0.1);
  color: #666;
}
`;function rt(){if(document.getElementById("blindspot-styles"))return;let t=document.createElement("style");t.id="blindspot-styles",t.textContent=Jt,document.head.appendChild(t)}var Kt=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
</svg>
`,u=null,_=null;function at(t,e={}){if(u)return u;_=t;let n=e.color||"#FE795D",o=e.text||"Report issue";return u=document.createElement("button"),u.className="blindspot-trigger",u.innerHTML=`
    ${Kt}
    <span class="blindspot-trigger-text">${o}</span>
    <span class="blindspot-trigger-dots">
      <span></span>
      <span></span>
      <span></span>
    </span>
  `,u.setAttribute("aria-label",o),u.style.background=n,u.dataset.color=n,u.addEventListener("click",Gt),document.body.appendChild(u),u}function Gt(){console.log("[Blindspot] Trigger clicked"),_&&_()}function dt(){u&&(u.style.display="none")}function V(){u&&(u.style.display="flex")}var Zt="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js",ct=!1;function Qt(){return new Promise((t,e)=>{if(ct&&window.html2canvas){t(window.html2canvas);return}let n=document.createElement("script");n.src=Zt,n.onload=()=>{ct=!0,console.log("[Blindspot] html2canvas loaded"),t(window.html2canvas)},n.onerror=()=>{e(new Error("Failed to load html2canvas"))},document.head.appendChild(n)})}async function pt(){console.log("[Blindspot] Capturing screenshot...");let t=await Qt(),e=document.querySelector(".blindspot-trigger");e&&(e.style.visibility="hidden");try{let n=te(),o=window.getComputedStyle(document.body).backgroundColor,i=window.getComputedStyle(document.documentElement).backgroundColor,r=o!=="rgba(0, 0, 0, 0)"?o:i!=="rgba(0, 0, 0, 0)"?i:"#ffffff",s=await t(document.documentElement,{useCORS:!0,allowTaint:!0,backgroundColor:r,scrollX:-window.scrollX,scrollY:-window.scrollY,windowWidth:document.documentElement.clientWidth,windowHeight:document.documentElement.clientHeight,width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,x:window.scrollX,y:window.scrollY}),l=s.toDataURL("image/png");return console.log("[Blindspot] Screenshot captured",{width:s.width,height:s.height,size:Math.round(l.length/1024)+"kb",elements:n.length}),{dataUrl:l,elementMap:n,viewport:{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}}finally{e&&(e.style.visibility="visible")}}function te(){let t=[],e=window.scrollX,n=window.scrollY,o=window.innerWidth,i=window.innerHeight,r=document.createTreeWalker(document.body,NodeFilter.SHOW_ELEMENT,{acceptNode:l=>l.offsetParent===null&&l.tagName!=="BODY"||l.classList?.contains("blindspot-trigger")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),s;for(;s=r.nextNode();){let l=s.getBoundingClientRect();if(l.width<5||l.height<5||l.bottom<0||l.top>i||l.right<0||l.left>o)continue;let c=s.tagName.toLowerCase(),y=s.id||null,T=s.className&&typeof s.className=="string"?s.className.split(" ").filter(f=>f&&!f.startsWith("blindspot-")):[],F=window.getComputedStyle(s),C=F.backgroundColor,X=F.color,H="";for(let f of s.childNodes)f.nodeType===Node.TEXT_NODE&&(H+=f.textContent);H=H.trim().substring(0,150);let zt=s.innerText?.trim().substring(0,200)||"",Y=c;y?Y=`${c}#${y}`:T.length>0&&(Y=`${c}.${T.slice(0,2).join(".")}`);let jt=ee(s),st={};for(let f of s.attributes)f.name.startsWith("data-")&&(st[f.name]=f.value);let Wt=ne(s),qt=oe(s),m={rect:{left:l.left,top:l.top,right:l.right,bottom:l.bottom,width:l.width,height:l.height},tagName:c,id:y,classes:T,text:H,innerText:zt,selector:Y,fullSelector:jt,dataAttributes:st,accessibleName:Wt,context:qt,styles:{backgroundColor:C!=="rgba(0, 0, 0, 0)"?C:null,color:X}};c==="a"&&s.href&&(m.href=s.href),c==="img"&&(m.src=s.src,m.alt=s.alt),(c==="input"||c==="button"||c==="select"||c==="textarea")&&(m.type=s.type,m.name=s.name,m.placeholder=s.placeholder,m.value=s.value?.substring(0,100)),s.getAttribute("aria-label")&&(m.ariaLabel=s.getAttribute("aria-label")),s.getAttribute("role")&&(m.role=s.getAttribute("role")),t.push(m)}return t.sort((l,c)=>l.rect.width*l.rect.height-c.rect.width*c.rect.height),console.log("[Blindspot] Element map captured:",t.length,"elements"),t}function ee(t){let e=[],n=t;for(;n&&n!==document.body&&n!==document.documentElement;){let o=n.tagName.toLowerCase();if(n.id){o=`#${n.id}`,e.unshift(o);break}let i=Array.from(n.classList).filter(s=>!s.startsWith("blindspot-")).slice(0,2);i.length&&(o+="."+i.join("."));let r=n.parentElement;if(r){let s=Array.from(r.children).filter(l=>l.tagName===n.tagName);if(s.length>1){let l=s.indexOf(n)+1;o+=`:nth-child(${l})`}}e.unshift(o),n=n.parentElement}return e.join(" > ")}function ne(t){let e=t.getAttribute("aria-label");if(e)return e;let n=t.getAttribute("aria-labelledby");if(n){let i=document.getElementById(n);if(i)return i.textContent?.trim()}let o=t.getAttribute("title");if(o)return o;if(t.id){let i=document.querySelector(`label[for="${t.id}"]`);if(i)return i.textContent?.trim()}return["BUTTON","A"].includes(t.tagName)?t.textContent?.trim().substring(0,100)||null:t.tagName==="IMG"&&t.alt||null}function oe(t){let e=[],n=t.parentElement,o=0;for(;n&&o<5;){let r=n.getAttribute("role"),s=n.tagName.toLowerCase();if(["header","nav","main","aside","footer","section","article"].includes(s)){let c=n.getAttribute("aria-label")||n.id||"";e.push(c?`${s}[${c}]`:s)}else r&&["banner","navigation","main","complementary","contentinfo","region"].includes(r)&&e.push(`[role=${r}]`);let l=n.getAttribute("data-testid")||n.getAttribute("data-component");l&&e.push(`[data-testid=${l}]`),n=n.parentElement,o++}let i=t.closest("ul, ol");if(i){let r=Array.from(i.children).filter(l=>l.tagName==="LI"),s=t.closest("li");if(s&&r.includes(s)){let l=r.indexOf(s)+1;e.push(`list item ${l} of ${r.length}`)}}return e.length>0?e.join(" > "):null}var J=null;function ut(t,e){return J=e,`
    <div class="blindspot-sidebar-content">
      <div class="blindspot-sidebar-header">
        <h2 class="blindspot-sidebar-title">Report Issue</h2>
      </div>

      <form class="blindspot-form" id="blindspot-form">
        <div class="blindspot-form-group">
          <label class="blindspot-label" for="blindspot-title">Title *</label>
          <input
            type="text"
            id="blindspot-title"
            class="blindspot-input"
            placeholder="Brief description of the issue"
            required
          />
        </div>

        <div class="blindspot-form-group">
          <label class="blindspot-label" for="blindspot-description">Description</label>
          <textarea
            id="blindspot-description"
            class="blindspot-textarea"
            placeholder="Steps to reproduce, expected behavior, etc."
            rows="4"
          ></textarea>
        </div>

        <div class="blindspot-form-group">
          <label class="blindspot-label" for="blindspot-reporter">Submitted by *</label>
          <input
            type="text"
            id="blindspot-reporter"
            class="blindspot-input"
            placeholder=""
            autocomplete="off"
            data-1p-ignore
            data-lpignore="true"
            required
          />
        </div>

        <div class="blindspot-form-group blindspot-elements-section" style="display: none;">
          <label class="blindspot-label">Selected Elements</label>
          <div class="blindspot-elements-list"></div>
        </div>

        <div class="blindspot-form-group">
          <label class="blindspot-label">Captured Info</label>
          <div class="blindspot-metadata">
            <div class="blindspot-metadata-item">
              <span class="blindspot-metadata-label">URL</span>
              <span class="blindspot-metadata-value" title="${t.url}">${K(t.url,35)}</span>
            </div>
            <div class="blindspot-metadata-item">
              <span class="blindspot-metadata-label">Browser</span>
              <span class="blindspot-metadata-value">${t.browser}</span>
            </div>
            <div class="blindspot-metadata-item">
              <span class="blindspot-metadata-label">OS</span>
              <span class="blindspot-metadata-value">${t.os}</span>
            </div>
            <div class="blindspot-metadata-item">
              <span class="blindspot-metadata-label">Viewport</span>
              <span class="blindspot-metadata-value">${t.viewport}</span>
            </div>
          </div>
        </div>

        <button type="submit" class="blindspot-submit-btn">
          Submit Bug Report
        </button>
      </form>
    </div>
  `}function ht(){let t=document.getElementById("blindspot-form");t&&t.addEventListener("submit",ie)}function ie(t){t.preventDefault();let e=document.getElementById("blindspot-title").value.trim(),n=document.getElementById("blindspot-description").value.trim(),o=document.getElementById("blindspot-reporter").value.trim();e&&(console.log("[Blindspot] Form submitted",{title:e,description:n,reporter:o}),J&&J({title:e,description:n,reporter:o}))}function K(t,e){return t.length<=e?t:t.substring(0,e)+"..."}function G(t,e){let n=document.querySelector(".blindspot-elements-section"),o=document.querySelector(".blindspot-elements-list");if(!(!n||!o)){if(t.length===0){n.style.display="none",o.innerHTML="";return}n.style.display="block",o.innerHTML=t.map((i,r)=>`
    <div class="blindspot-element-chip" data-index="${r}">
      <span class="blindspot-element-tag">${i.tagName}</span>
      <span class="blindspot-element-detail">${le(i)}</span>
      <button type="button" class="blindspot-element-remove" data-index="${r}" aria-label="Remove">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
  `).join(""),o.querySelectorAll(".blindspot-element-remove").forEach(i=>{i.addEventListener("click",r=>{r.preventDefault();let s=parseInt(i.dataset.index,10);e&&e(s)})})}}function le(t){let e="";if(t.id?e=`#${t.id}`:t.classes&&t.classes.length>0&&(e=`.${t.classes[0]}`),t.text&&t.text.length>0){let n=K(t.text,25);e+=e?` "${n}"`:`"${n}"`}else if(t.innerText&&t.innerText.length>0){let n=K(t.innerText,25);e+=e?` "${n}"`:`"${n}"`}return e||t.selector||t.tagName}function gt(){return{url:window.location.href,browser:se(),os:re(),viewport:`${window.innerWidth}x${window.innerHeight}`,screenSize:`${window.screen.width}x${window.screen.height}`,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,consoleErrors:de()}}function se(){let t=navigator.userAgent;if(t.includes("Firefox/")){let e=t.match(/Firefox\/(\d+)/);return`Firefox ${e?e[1]:""}`}if(t.includes("Edg/")){let e=t.match(/Edg\/(\d+)/);return`Edge ${e?e[1]:""}`}if(t.includes("Chrome/")){let e=t.match(/Chrome\/(\d+)/);return`Chrome ${e?e[1]:""}`}if(t.includes("Safari/")&&!t.includes("Chrome")){let e=t.match(/Version\/(\d+)/);return`Safari ${e?e[1]:""}`}return"Unknown"}function re(){let t=navigator.userAgent;if(t.includes("Mac OS X")){let e=t.match(/Mac OS X (\d+[._]\d+)/);return e?`macOS ${e[1].replace("_",".")}`:"macOS"}return t.includes("Windows NT 10")?"Windows 10/11":t.includes("Windows NT 6.3")?"Windows 8.1":t.includes("Windows NT 6.2")?"Windows 8":t.includes("Windows NT 6.1")?"Windows 7":t.includes("Linux")?"Linux":t.includes("Android")?"Android":t.includes("iOS")||t.includes("iPhone")||t.includes("iPad")?"iOS":"Unknown"}var L=[],bt=10,ae=console.error;console.error=function(...t){L.push({type:"error",message:t.map(e=>String(e)).join(" "),timestamp:new Date().toISOString()}),L.length>bt&&L.shift(),ae.apply(console,t)};typeof window<"u"&&window.addEventListener("error",t=>{L.push({type:"uncaught",message:t.message,filename:t.filename,line:t.lineno,timestamp:new Date().toISOString()}),L.length>bt&&L.shift()});function de(){return[...L]}var d=null,a=null,z=!1,x="arrow",k=0,E=0,Z=0,Q=0,b=[],N=null,h=null,j="#9B78F4",ft=8,ce=24;function tt(t){d=t,a=d.getContext("2d"),a.strokeStyle=j,a.lineWidth=ft,a.lineCap="round",a.lineJoin="round",d.addEventListener("mousedown",et),d.addEventListener("mousemove",nt),d.addEventListener("mouseup",R),d.addEventListener("mouseleave",R),d.addEventListener("touchstart",kt,{passive:!1}),d.addEventListener("touchmove",Et,{passive:!1}),d.addEventListener("touchend",St),console.log("[Blindspot] Canvas initialized",{width:d.width,height:d.height})}function xt(t){x=t,console.log("[Blindspot] Tool set to:",t)}function vt(){!a||!d||(a.clearRect(0,0,d.width,d.height),b=[],console.log("[Blindspot] Canvas cleared"))}function wt(){b.length!==0&&(b.pop(),D(),console.log("[Blindspot] Undo - paths remaining:",b.length))}function yt(){return b.length>0}function et(t){let e=d.getBoundingClientRect(),n=d.width/e.width,o=d.height/e.height;if(k=(t.clientX-e.left)*n,E=(t.clientY-e.top)*o,Z=k,Q=E,x==="text"){pe(t.clientX,t.clientY,k,E);return}z=!0,x==="draw"&&(N={type:"draw",points:[{x:k,y:E}]})}function nt(t){if(!z)return;let e=d.getBoundingClientRect(),n=d.width/e.width,o=d.height/e.height,i=(t.clientX-e.left)*n,r=(t.clientY-e.top)*o;x==="draw"?(a.beginPath(),a.moveTo(Z,Q),a.lineTo(i,r),a.stroke(),N.points.push({x:i,y:r}),Z=i,Q=r):(D(),ue(i,r))}function R(t){if(!z)return;z=!1;let e=d.getBoundingClientRect(),n=d.width/e.width,o=d.height/e.height,i=(t.clientX-e.left)*n,r=(t.clientY-e.top)*o;x==="draw"&&N?(b.push(N),N=null):x==="arrow"?(b.push({type:"arrow",startX:k,startY:E,endX:i,endY:r}),D()):x==="rectangle"&&(b.push({type:"rectangle",startX:k,startY:E,endX:i,endY:r}),D())}function pe(t,e,n,o){I();let i=document.createElement("div");i.id="blindspot-text-container",i.style.cssText=`
    position: fixed;
    left: ${t}px;
    top: ${e}px;
    z-index: 2147483647;
    transform: translate(0, -50%);
  `,h=document.createElement("input"),h.type="text",h.style.cssText=`
    background: white;
    border: 2px solid ${j};
    border-radius: 4px;
    padding: 6px 10px;
    font-size: 14px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: #201E1D;
    outline: none;
    min-width: 150px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  `,h.placeholder="Type text...";let r=l=>{l.stopPropagation(),l.key==="Enter"?(l.preventDefault(),h.value.trim()&&mt(n,o,h.value.trim()),I()):l.key==="Escape"&&(l.preventDefault(),I())},s=()=>{setTimeout(()=>{h&&h.value.trim()&&mt(n,o,h.value.trim()),I()},100)};h.addEventListener("keydown",r),h.addEventListener("blur",s),i.appendChild(h),document.body.appendChild(i),setTimeout(()=>{h&&h.focus()},10),console.log("[Blindspot] Text input shown at",t,e)}function I(){let t=document.getElementById("blindspot-text-container");t&&t.remove(),h=null}function mt(t,e,n){b.push({type:"text",x:t,y:e,text:n}),D(),console.log("[Blindspot] Text added:",n)}function kt(t){t.preventDefault();let e=t.touches[0],n=new MouseEvent("mousedown",{clientX:e.clientX,clientY:e.clientY});et(n)}function Et(t){t.preventDefault();let e=t.touches[0],n=new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY});nt(n)}function St(t){let e=new MouseEvent("mouseup",{});R(e)}function ue(t,e){x==="arrow"?Tt(k,E,t,e):x==="rectangle"&&Ct(k,E,t,e)}function D(){a.clearRect(0,0,d.width,d.height),a.strokeStyle=j,a.lineWidth=ft;for(let t of b)t.type==="draw"?he(t.points):t.type==="arrow"?Tt(t.startX,t.startY,t.endX,t.endY):t.type==="rectangle"?Ct(t.startX,t.startY,t.endX,t.endY):t.type==="text"&&ge(t.x,t.y,t.text)}function he(t){if(!(t.length<2)){a.beginPath(),a.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)a.lineTo(t[e].x,t[e].y);a.stroke()}}function Tt(t,e,n,o){let r=Math.atan2(o-e,n-t);a.beginPath(),a.moveTo(t,e),a.lineTo(n,o),a.stroke(),a.beginPath(),a.moveTo(n,o),a.lineTo(n-25*Math.cos(r-Math.PI/6),o-25*Math.sin(r-Math.PI/6)),a.moveTo(n,o),a.lineTo(n-25*Math.cos(r+Math.PI/6),o-25*Math.sin(r+Math.PI/6)),a.stroke()}function Ct(t,e,n,o){a.beginPath(),a.rect(t,e,n-t,o-e),a.stroke()}function ge(t,e,n){a.font=`bold ${ce}px -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif`,a.fillStyle=j,a.fillText(n,t,e)}function Lt(){d&&(I(),d.removeEventListener("mousedown",et),d.removeEventListener("mousemove",nt),d.removeEventListener("mouseup",R),d.removeEventListener("mouseleave",R),d.removeEventListener("touchstart",kt),d.removeEventListener("touchmove",Et),d.removeEventListener("touchend",St),d=null,a=null,b=[])}var Bt=null,A=null,$=null,B={arrow:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="5" y1="12" x2="19" y2="12"/>
    <polyline points="12 5 19 12 12 19"/>
  </svg>`,rectangle:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
  </svg>`,text:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="4 7 4 4 20 4 20 7"/>
    <line x1="9" y1="20" x2="15" y2="20"/>
    <line x1="12" y1="4" x2="12" y2="20"/>
  </svg>`,draw:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 19l7-7 3 3-7 7-3-3z"/>
    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
    <path d="M2 2l7.586 7.586"/>
    <circle cx="11" cy="11" r="2"/>
  </svg>`,element:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M12 3a9 9 0 1 0 9 9"/>
    <circle cx="12" cy="12" r="3"/>
    <path d="M21 3l-6 6"/>
    <path d="M21 9V3h-6"/>
  </svg>`,undo:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 7v6h6"/>
    <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/>
  </svg>`,clear:`<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M3 6h18"/>
    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
  </svg>`};function $t(){return`
    <div class="blindspot-tool-group">
      <button class="blindspot-tool-btn active" data-tool="element" title="Select Element">
        ${B.element}
      </button>
    </div>
    <div class="blindspot-tool-divider"></div>
    <div class="blindspot-tool-group">
      <button class="blindspot-tool-btn" data-tool="arrow" title="Arrow">
        ${B.arrow}
      </button>
      <button class="blindspot-tool-btn" data-tool="rectangle" title="Box">
        ${B.rectangle}
      </button>
      <button class="blindspot-tool-btn" data-tool="text" title="Text">
        ${B.text}
      </button>
      <button class="blindspot-tool-btn" data-tool="draw" title="Freeform">
        ${B.draw}
      </button>
    </div>
    <div class="blindspot-tool-divider"></div>
    <div class="blindspot-tool-group">
      <button class="blindspot-tool-btn" data-action="undo" title="Undo">
        ${B.undo}
      </button>
      <button class="blindspot-tool-btn" data-action="clear" title="Clear all">
        ${B.clear}
      </button>
    </div>
  `}function Mt(t,e={}){Bt=t,$=e.onToolChange||null,t.querySelectorAll("[data-tool]").forEach(i=>{i.addEventListener("click",()=>{let r=i.dataset.tool;r!=="element"&&xt(r),be(i),$&&$(r)})}),t.querySelectorAll("[data-action]").forEach(i=>{i.addEventListener("click",()=>{let r=i.dataset.action;r==="undo"?wt():r==="clear"&&vt()})}),A=t.querySelector('[data-tool="element"]'),$&&$("element")}function be(t){A&&A.classList.remove("active"),t.classList.add("active"),A=t}function It(){Bt=null,A=null,$=null}var p=null,lt=null,q=null,M=null,P=null,W=null,ot=null,v=[],O=!1,g=null;function Nt(t,e={}){p||(lt=t.dataUrl,q=t.elementMap,M=t.viewport,W=e.onClose,ot=e.onSubmit,P=gt(),p=document.createElement("div"),p.className="blindspot-overlay",p.innerHTML=`
    <div class="blindspot-overlay-backdrop"></div>
    <div class="blindspot-overlay-content">
      <div class="blindspot-toolbar">
        <div class="blindspot-toolbar-tools">
          ${$t()}
        </div>
        <button class="blindspot-close-btn" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="blindspot-main">
        <div class="blindspot-canvas-area">
          <div class="blindspot-canvas-wrapper">
            <img class="blindspot-screenshot" src="${t.dataUrl}" alt="Screenshot" />
            <canvas class="blindspot-drawing-canvas"></canvas>
            <div class="blindspot-selected-highlights"></div>
            <div class="blindspot-element-highlight-overlay"></div>
          </div>
        </div>
        <div class="blindspot-sidebar">
          ${ut(P,ye)}
        </div>
      </div>
    </div>
  `,p.querySelector(".blindspot-close-btn").addEventListener("click",it),p.querySelector(".blindspot-overlay-backdrop").addEventListener("click",it),document.addEventListener("keydown",Rt),document.body.appendChild(p),document.body.style.overflow="hidden",setTimeout(()=>{let n=p.querySelector(".blindspot-toolbar-tools");Mt(n,{onToolChange:me});let o=p.querySelector(".blindspot-screenshot"),i=p.querySelector(".blindspot-drawing-canvas");o.onload=()=>{i.width=o.naturalWidth,i.height=o.naturalHeight,tt(i)},o.complete&&(i.width=o.naturalWidth,i.height=o.naturalHeight,tt(i)),ht()},0),console.log("[Blindspot] Overlay opened"))}function it(){p&&(document.removeEventListener("keydown",Rt),document.body.style.overflow="",Dt(),It(),Lt(),p.remove(),p=null,lt=null,q=null,M=null,P=null,v=[],g=null,W&&(W(),W=null),console.log("[Blindspot] Overlay closed"))}function Rt(t){t.key==="Escape"&&it()}function me(t){t==="element"?fe():Dt()}function fe(){O=!0;let t=p.querySelector(".blindspot-canvas-wrapper"),e=p.querySelector(".blindspot-screenshot");g=p.querySelector(".blindspot-element-highlight-overlay");let n=()=>{g.style.cssText=`
      position: absolute;
      top: 0;
      left: 0;
      width: ${e.offsetWidth}px;
      height: ${e.offsetHeight}px;
      pointer-events: none;
      z-index: 10;
    `};e.complete&&n(),e.addEventListener("load",n),t.style.cursor="crosshair",t.addEventListener("mousemove",At),t.addEventListener("click",Ot),xe(),console.log("[Blindspot] Screenshot element picker activated")}function Dt(){if(!O)return;O=!1;let t=p?.querySelector(".blindspot-canvas-wrapper");t&&(t.style.cursor="",t.removeEventListener("mousemove",At),t.removeEventListener("click",Ot)),g&&(g.innerHTML=""),ve(),console.log("[Blindspot] Screenshot element picker deactivated")}function At(t){if(!O||!q)return;let n=p.querySelector(".blindspot-screenshot").getBoundingClientRect();if(t.clientX<n.left||t.clientX>n.right||t.clientY<n.top||t.clientY>n.bottom){g.innerHTML="",g.dataset.currentElement="";return}let o=n.width/M.width,i=n.height/M.height,r=(t.clientX-n.left)/o,s=(t.clientY-n.top)/i,l=q.find(c=>r>=c.rect.left&&r<=c.rect.right&&s>=c.rect.top&&s<=c.rect.bottom);if(l){let c=l.rect.left*o,y=l.rect.top*i,T=l.rect.width*o,F=l.rect.height*i,C=l.tagName;l.id?C+=`#${l.id}`:l.classes.length&&(C+=`.${l.classes[0]}`),l.text&&l.text.length>0&&(C+=` "${l.text.substring(0,30)}${l.text.length>30?"...":""}"`);let X=Math.max(0,y-28);g.innerHTML=`
      <div style="
        position: absolute;
        left: ${c}px;
        top: ${y}px;
        width: ${T}px;
        height: ${F}px;
        border: 3px solid #9B78F4;
        background: rgba(155, 120, 244, 0.15);
        border-radius: 4px;
        pointer-events: none;
        box-sizing: border-box;
      "></div>
      <div style="
        position: absolute;
        left: ${c}px;
        top: ${X}px;
        background: #201E1D;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        font-size: 12px;
        pointer-events: none;
        white-space: nowrap;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
      ">${C}</div>
    `,g.dataset.currentElement=JSON.stringify(l)}else g.innerHTML="",g.dataset.currentElement=""}function Ot(t){if(!O||!g.dataset.currentElement)return;let e=JSON.parse(g.dataset.currentElement);we({selector:e.selector,fullSelector:e.fullSelector,tagName:e.tagName,id:e.id,classes:e.classes,text:e.text,dataAttributes:e.dataAttributes,accessibleName:e.accessibleName,context:e.context,rect:e.rect})}var S=null;function xe(){S=document.createElement("div"),S.className="blindspot-picker-instruction",S.style.cssText=`
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    background: #201E1D;
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    z-index: 2147483647;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  `,S.textContent="Click on an element to select it",document.body.appendChild(S)}function ve(){S&&(S.remove(),S=null)}function we(t){v.some(n=>n.selector===t.selector)?console.log("[Blindspot] Element already selected:",t.selector):(v.push(t),G(v,Ft),Ht(),console.log("[Blindspot] Element added:",t.selector))}function Ft(t){v.splice(t,1),G(v,Ft),Ht(),console.log("[Blindspot] Element removed, remaining:",v.length)}function Ht(){let t=p?.querySelector(".blindspot-selected-highlights");if(!t)return;let e=p.querySelector(".blindspot-screenshot");if(!e)return;let n=e.getBoundingClientRect(),o=n.width/M.width,i=n.height/M.height,r="";for(let s of v){if(!s.rect)continue;let l=s.rect.left*o,c=s.rect.top*i,y=s.rect.width*o,T=s.rect.height*i;r+=`
      <div style="
        position: absolute;
        left: ${l}px;
        top: ${c}px;
        width: ${y}px;
        height: ${T}px;
        border: 3px solid #9B78F4;
        background: rgba(155, 120, 244, 0.15);
        border-radius: 4px;
        pointer-events: none;
        box-sizing: border-box;
      "></div>
    `}t.innerHTML=r}function ye(t){if(ot){let e=lt;yt()&&(e=ke()),ot({...t,screenshot:e,metadata:P,elements:v})}}function ke(){let t=p.querySelector(".blindspot-screenshot"),e=p.querySelector(".blindspot-drawing-canvas"),n=document.createElement("canvas");n.width=t.naturalWidth,n.height=t.naturalHeight;let o=n.getContext("2d");return o.drawImage(t,0,0),o.drawImage(e,0,0),n.toDataURL("image/png")}var Ee="https://blindspot-api.jasper-414.workers.dev",w={siteId:null,color:"#FE795D",text:"Report issue"};function Se(t={}){if(!t.siteId){console.error("[Blindspot] Missing required option: siteId");return}w.siteId=t.siteId,w.color=t.color||"#FE795D",w.text=t.text||"Report issue",rt(),at(Te,{color:w.color,text:w.text}),console.log("[Blindspot] Initialized",{siteId:w.siteId,color:w.color,text:w.text})}async function Te(){console.log("[Blindspot] Starting capture mode...");try{dt();let t=await pt();console.log("[Blindspot] Screenshot ready, opening overlay..."),Nt(t,{onClose:()=>{V()},onSubmit:Ce})}catch(t){console.error("[Blindspot] Capture failed:",t),V()}}async function Ce(t){console.log("[Blindspot] Submitting report...",t);let e=document.querySelector(".blindspot-submit-btn");e&&(e.disabled=!0,e.textContent="Submitting...");try{let n=await fetch(`${Ee}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:w.siteId,title:t.title,description:t.description,reporter:t.reporter,screenshot:t.screenshot,metadata:t.metadata,elements:t.elements})}),o=await n.json();if(!n.ok)throw new Error(o.error||"Failed to submit report");console.log("[Blindspot] Report submitted successfully:",o),Le(o.issueUrl)}catch(n){console.error("[Blindspot] Submit failed:",n),alert(`Failed to submit report: ${n.message}`),e&&(e.disabled=!1,e.textContent="Submit Bug Report")}}function Le(t){let e=document.querySelector(".blindspot-sidebar-content");e&&(e.innerHTML=`
      <div class="blindspot-success">
        <div class="blindspot-success-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        </div>
        <h3 class="blindspot-success-title">Report Submitted!</h3>
        <p class="blindspot-success-text">Your bug report has been created successfully.</p>
        ${t?`<a href="${t}" target="_blank" class="blindspot-success-link">View Issue on GitHub</a>`:""}
        <button class="blindspot-close-overlay-btn" onclick="document.querySelector('.blindspot-close-btn').click()">Close</button>
      </div>
    `)}return Vt(Be);})();
